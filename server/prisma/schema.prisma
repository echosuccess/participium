generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                          Int             @id @default(autoincrement())
  email                       String          @unique
  first_name                  String
  last_name                   String
  password                    String
  salt                        String
  role                        Role            @default(CITIZEN)
  telegram_username           String?
  email_notifications_enabled Boolean         @default(true)
  assignedReports             Report[]        @relation("AssignedReports")
  reports                     Report[]
  messages                    ReportMessage[]
  photo                       CitizenPhoto?   
}

model Report {
  id             Int             @id @default(autoincrement())
  title          String
  description    String
  category       ReportCategory
  latitude       Float
  longitude      Float
  address        String?
  isAnonymous    Boolean         @default(false)
  status         ReportStatus    @default(PENDING_APPROVAL)
  userId         Int
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  assignedToId   Int?
  rejectedReason String?
  assignedTo     User?           @relation("AssignedReports", fields: [assignedToId], references: [id])
  user           User            @relation(fields: [userId], references: [id])
  messages       ReportMessage[]
  photos         ReportPhoto[]
}

model ReportPhoto {
  id       Int    @id @default(autoincrement())
  url      String
  filename String
  reportId Int
  report   Report @relation(fields: [reportId], references: [id])
}

model ReportMessage {
  id        Int      @id @default(autoincrement())
  content   String
  createdAt DateTime @default(now())
  reportId  Int
  senderId  Int
  report    Report   @relation(fields: [reportId], references: [id])
  user      User     @relation(fields: [senderId], references: [id])
}

model CitizenPhoto {
  id       Int    @id @default(autoincrement())
  url      String
  filename String
  userId   Int    @unique
  user     User   @relation(fields: [userId], references: [id])
}

enum Role {
  CITIZEN
  ADMINISTRATOR
  PUBLIC_RELATIONS
  CULTURE_EVENTS_TOURISM_SPORTS
  LOCAL_PUBLIC_SERVICES
  EDUCATION_SERVICES
  PUBLIC_RESIDENTIAL_HOUSING
  INFORMATION_SYSTEMS
  MUNICIPAL_BUILDING_MAINTENANCE
  PRIVATE_BUILDINGS
  INFRASTRUCTURES
  GREENSPACES_AND_ANIMAL_PROTECTION
  WASTE_MANAGEMENT
  ROAD_MAINTENANCE
  CIVIL_PROTECTION
}

enum ReportCategory {
  WATER_SUPPLY_DRINKING_WATER
  ARCHITECTURAL_BARRIERS
  SEWER_SYSTEM
  PUBLIC_LIGHTING
  WASTE
  ROAD_SIGNS_TRAFFIC_LIGHTS
  ROADS_URBAN_FURNISHINGS
  PUBLIC_GREEN_AREAS_PLAYGROUNDS
  OTHER
}

enum ReportStatus {
  PENDING_APPROVAL
  ASSIGNED
  IN_PROGRESS
  SUSPENDED
  REJECTED
  RESOLVED
}
